<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gravner-Griffeath Snowflake Simulation</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-100">
    
    <!-- Article Section -->
    <div class="bg-gray-900">
        <div class="max-w-6xl mx-auto px-8 py-12" id="article-container">
            <!-- Article content will be loaded here -->
        </div>
    </div>

    <!-- Simulation Section -->
    <div class="bg-gradient-to-b from-gray-900 to-gray-800 py-8">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-200">Interactive Simulation</h2>
            <p class="text-gray-400 mt-2">Adjust parameters below to explore different snowflake patterns</p>
        </div>
        
        <div class="flex flex-col md:flex-row">
            <!-- Simulation Canvas -->
            <div class="flex-1 flex items-center justify-center p-8">
                <canvas id="simulation" class="w-[min(90vw,90vh)]"></canvas>
            </div>

            <!-- Sidebar Controls -->
            <div class="w-full lg:w-80 xl:w-96 bg-gray-800 overflow-y-auto p-6 space-y-12">
                <div class="text-4xl font-bold flex justify-center items-center flex-col">
                    <h2>Controls</h2>
                    <button id="play-pause-button" class="material-icons text-6xl text-gray-100 hover:text-blue-400" onclick="play_pause()">pause</button>
                </div>

                <!-- Presets of nice snowflakes -->
                <div class="space-y-4">
                    <h3 class="text-xl font-semibold text-gray-300">Presets</h3>
                    <div id="preset-container"></div>
                </div>

                <div class="space-y-12 text-2xl">
                    <!-- Iterations Slider -->
                    <div class="space-y-4">
                        <label for="iterations-per-frame" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Iterations per Frame
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Number of simulation steps per frame
                                </span>
                            </span>
                            <span id="iterations-per-frame-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="iterations-per-frame" min="1" max="25" step="1" oninput="set_iterations_per_frame(this.value)" onchange="set_iterations_per_frame(this.value)">
                    </div>

                    <!-- Rho Slider -->
                    <div class="space-y-4">
                        <label for="rho" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Rho (ρ)
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Background vapor density (humidity)
                                </span>
                            </span>
                            <span id="rho-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="rho" min="0.0" max="1.0" step="0.01" oninput="set_rho(this.value)" onchange="set_rho(this.value)">
                    </div>

                    <!-- Beta Slider -->
                    <div class="space-y-4">
                        <label for="beta" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Beta (β)
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Attachment threshold at tips/edges
                                </span>
                            </span>
                            <span id="beta-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="beta" min="1.0" max="3.0" step="0.01" oninput="set_beta(this.value)" onchange="set_beta(this.value)">
                    </div>

                    <!-- Kappa Slider -->
                    <div class="space-y-4">
                        <label for="kappa" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Kappa (κ)
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Direct crystallization rate
                                </span>
                            </span>
                            <span id="kappa-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="kappa" min="0.0" max="0.1" step="0.001" oninput="set_kappa(this.value)" onchange="set_kappa(this.value)">
                    </div>

                    <!-- Mu Slider -->
                    <div class="space-y-4">
                        <label for="mu" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Mu (μ)
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Boundary mass evaporation rate
                                </span>
                            </span>
                            <span id="mu-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="mu" min="0.0" max="0.1" step="0.001" oninput="set_mu(this.value)" onchange="set_mu(this.value)">
                    </div>

                    <!-- Alpha Slider -->
                    <div class="space-y-4">
                        <label for="alpha" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Alpha (α)
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Reduced attachment threshold
                                </span>
                            </span>
                            <span id="alpha-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="alpha" min="0.0" max="1.0" step="0.01" oninput="set_alpha(this.value)" onchange="set_alpha(this.value)">
                    </div>

                    <!-- Theta Slider -->
                    <div class="space-y-4">
                        <label for="theta" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Theta (θ)
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Vapor threshold for knife-edge effect
                                </span>
                            </span>
                            <span id="theta-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="theta" min="0.0" max="0.1" step="0.001" oninput="set_theta(this.value)" onchange="set_theta(this.value)">
                    </div>

                    <!-- Grid Size Slider -->
                    <div class="space-y-4">
                        <label for="grid-size" class="flex items-center justify-around text-gray-300">
                            <span class="group relative cursor-help">
                                Grid Size
                                <span class="invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-sm bg-gray-700 text-gray-100 rounded-lg whitespace-nowrap border border-gray-600 z-10">
                                    Simulation grid dimensions
                                </span>
                            </span>
                            <span id="grid-size-output"></span>
                        </label>
                        <input type="range" class="w-full h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-400 hover:accent-cyan-400" id="grid-size" min="100" max="1000" step="25" oninput="set_grid_size(this.value)" onchange="set_grid_size(this.value)">
                    </div>

                    <!-- Reset Button -->
                    <div class="pt-4 pb-8">
                        <button onclick="reset()" class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-95">
                            Reset System
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load the article content
        fetch('description.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('article-container').innerHTML = html;
                // Trigger MathJax to render equations
                if (window.MathJax) {
                    MathJax.typesetPromise();
                }
            });
    </script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="wasm/gg_model.js"></script>
    <script src="js/simulation.js"></script>
</body>
</html>